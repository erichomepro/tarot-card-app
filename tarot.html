<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instant Tarot Card Reading - Tarot Card Tube</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --gold-color: #D4AF37;
            --text-color: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #000000;
            color: var(--text-color);
            line-height: 1.6;
            background-image: url('images/pdf-background.jpg');
            background-size: cover;
            background-position: center;
            min-height: 100vh;
            position: relative;
        }

        .header {
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 100;
        }

        .logo img {
            height: 65px;
            width: auto;
            opacity: 1;
            transition: transform 0.3s ease;
            margin-top: 10px;
        }

        .logo:hover img {
            transform: scale(1.1);
        }

        .nav-menu {
            display: flex;
            gap: 2rem;
        }

        .nav-menu a {
            color: var(--text-color);
            text-decoration: none;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        .main-content {
            text-align: center;
            padding: 2rem;
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
        }

        .page-title {
            font-size: 2.5rem;
            color: var(--gold-color);
            margin-bottom: 2rem;
            font-weight: 300;
            letter-spacing: 4px;
        }

        .reading-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            margin-top: 2rem;
        }

        .client-info {
            background: rgba(0, 0, 0, 0.7);
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            width: 100%;
            max-width: 600px;
            border: 1px solid var(--gold-color);
        }

        .client-info h2 {
            color: var(--gold-color);
            font-size: 1.5rem;
            margin-bottom: 1rem;
            font-weight: 300;
            letter-spacing: 2px;
        }

        .info-text {
            color: #ccc;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .input-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--gold-color);
        }

        .client-input {
            width: 100%;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--gold-color);
            border-radius: 5px;
            color: var(--text-color);
            font-size: 1rem;
        }

        .required {
            color: #ff4444;
            margin-left: 4px;
        }

        .client-input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
        }

        .questions-section {
            width: 100%;
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid var(--gold-color);
            border-radius: 10px;
        }

        .section-title {
            color: var(--gold-color);
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 300;
            letter-spacing: 2px;
        }

        .question-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            align-items: center;
        }

        .question-input-wrapper {
            flex: 1;
        }

        .question-label {
            display: block;
            color: var(--gold-color);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            letter-spacing: 1px;
        }

        .question-input {
            width: 100%;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--gold-color);
            border-radius: 5px;
            color: var(--text-color);
            font-size: 1rem;
        }

        .card-number-select {
            width: 100px;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--gold-color);
            color: var(--gold-color);
            border-radius: 5px;
            cursor: pointer;
        }

        .card-number-select option {
            background: #1a1a1a;
        }

        .reading-type-group {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(218, 165, 32, 0.3);
        }

        .reading-type-label {
            display: block;
            color: var(--gold-color);
            margin-bottom: 1.5rem;
            font-size: 1.2rem;
            text-transform: none;
            letter-spacing: 1px;
            text-align: center;
            line-height: 1.6;
            font-style: italic;
        }

        .reading-type-select {
            width: 100%;
            max-width: 300px;
            padding: 1rem;
            background: rgba(218, 165, 32, 0.1);
            border: 2px solid var(--gold-color);
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1rem;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23DAA520%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.4-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem top 50%;
            background-size: 0.8rem auto;
            margin: 0 auto;
        }

        .reading-type-select:hover {
            background-color: rgba(218, 165, 32, 0.2);
        }

        .reading-type-select option {
            background: #1a1a1a;
            padding: 12px;
            color: white;
            font-size: 1rem;
            letter-spacing: 0.5px;
        }

        .draw-button {
            background: linear-gradient(45deg, rgba(218, 165, 32, 0.1), rgba(218, 165, 32, 0.2));
            color: var(--gold-color);
            border: 2px solid var(--gold-color);
            padding: 1.2rem 2.5rem;
            font-size: 1.3rem;
            cursor: pointer;
            border-radius: 5px;
            margin: 2rem 0;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 0 15px rgba(218, 165, 32, 0.1);
        }

        .draw-button:hover {
            background: linear-gradient(45deg, rgba(218, 165, 32, 0.2), rgba(218, 165, 32, 0.3));
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(218, 165, 32, 0.2);
        }

        .video-section {
            margin: 2rem auto;
            max-width: 800px;
            padding: 2rem;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            border: 1px solid var(--gold-color);
        }

        .video-section h2 {
            color: var(--gold-color);
            text-align: center;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
        }

        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            border-radius: 10px;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        @media (max-width: 768px) {
            .page-title {
                font-size: 2rem;
            }

            .question-group {
                flex-direction: column;
                gap: 0.5rem;
            }

            .card-number-select {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="background-overlay"></div>
    
    <header class="header">
        <a href="index.html" class="logo">
            <img src="images/logo.png" alt="Tarot Card Tube Logo">
        </a>
        <nav class="nav-menu">
            <a href="index.html">HOME</a>
            <a href="tarot.html">TAROT</a>
            <a href="#">HOROSCOPE</a>
            <a href="#">CONTACT</a>
        </nav>
    </header>

    <main class="main-content">
        <h1 class="page-title">INSTANT TAROT CARD READING</h1>

        <div class="reading-section">
            <div class="client-info">
                <h2>Personal Information</h2>
                <p class="info-text">Please provide your details below. Your email address is required to receive your personalized PDF tarot reading directly to your inbox. All information is kept confidential and secure.</p>
                
                <form id="tarotForm" onsubmit="return handleFormSubmit(event)">
                    <div class="input-group">
                        <label for="client-name">Full Name<span class="required">*</span></label>
                        <input type="text" id="client-name" class="client-input" required>
                    </div>
                    
                    <div class="input-group">
                        <label for="client-email">Email Address<span class="required">*</span></label>
                        <input type="email" id="client-email" class="client-input" required>
                    </div>
                    
                    <div class="input-group">
                        <label for="client-birthdate">Date of Birth<span class="required">*</span></label>
                        <input type="date" id="client-birthdate" class="client-input" required>
                    </div>

                    <div class="video-section">
                        <h2>How to Ask the Right Questions</h2>
                        <div class="video-container">
                            <iframe 
                                width="560" 
                                height="315" 
                                src="https://www.youtube.com/embed/sp2TLoYf66E?start=9"
                                title="How to Ask Questions in Tarot Reading"
                                frameborder="0"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                                allowfullscreen>
                            </iframe>
                        </div>
                    </div>

                    <div class="questions-section">
                        <h2>Your Three Questions for the Cards</h2>
                        
                        <div class="question-group">
                            <div class="question-input-wrapper">
                                <label class="question-label">Question 1:<span class="required">*</span></label>
                                <input type="text" class="question-input" id="question1" required>
                            </div>
                            <div class="card-select-wrapper">
                                <label class="question-label">Card Number:<span class="required">*</span></label>
                                <select class="card-number-select" id="card1" required>
                                    <option value="">Select a card</option>
                                    <script>
                                        for(let i = 1; i <= 78; i++) {
                                            document.write(`<option value="${i}">${i}</option>`);
                                        }
                                    </script>
                                </select>
                            </div>
                        </div>

                        <div class="question-group">
                            <div class="question-input-wrapper">
                                <label class="question-label">Question 2:<span class="required">*</span></label>
                                <input type="text" class="question-input" id="question2" required>
                            </div>
                            <div class="card-select-wrapper">
                                <label class="question-label">Card Number:<span class="required">*</span></label>
                                <select class="card-number-select" id="card2" required>
                                    <option value="">Select a card</option>
                                    <script>
                                        for(let i = 1; i <= 78; i++) {
                                            document.write(`<option value="${i}">${i}</option>`);
                                        }
                                    </script>
                                </select>
                            </div>
                        </div>

                        <div class="question-group">
                            <div class="question-input-wrapper">
                                <label class="question-label">Question 3:<span class="required">*</span></label>
                                <input type="text" class="question-input" id="question3" required>
                            </div>
                            <div class="card-select-wrapper">
                                <label class="question-label">Card Number:<span class="required">*</span></label>
                                <select class="card-number-select" id="card3" required>
                                    <option value="">Select a card</option>
                                    <script>
                                        for(let i = 1; i <= 78; i++) {
                                            document.write(`<option value="${i}">${i}</option>`);
                                        }
                                    </script>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="reading-type-group">
                        <h3>Choose Your Reading Type<span class="required">*</span></h3>
                        <select id="reading-type" class="reading-type-select" required>
                            <option value="">Select Reading Type</option>
                            <option value="situation-action-outcome">Situation - Action - Outcome</option>
                            <option value="past-present-future">Past - Present - Future</option>
                            <option value="mind-body-spirit">Mind - Body - Spirit</option>
                        </select>
                    </div>

                    <button type="submit" class="draw-button" id="submitButton">
                        <span class="button-text">Enter into the Realm of Tarot</span>
                        <i class="fas fa-moon"></i>
                    </button>
                </form>
            </div>
        </div>

        <script src="config.js"></script>
        <script>
            async function handleFormSubmit(event) {
                event.preventDefault();
                
                // Disable submit button to prevent double submission
                const submitButton = document.getElementById('submitButton');
                submitButton.disabled = true;
                submitButton.innerHTML = '<span class="button-text">Preparing Your Reading...</span>';

                try {
                    // Get user information
                    const userData = {
                        name: document.getElementById('client-name').value.trim(),
                        email: document.getElementById('client-email').value.trim(),
                        birthdate: document.getElementById('client-birthdate').value,
                        readingType: document.getElementById('reading-type').value,
                        questions: [
                            document.getElementById('question1').value.trim(),
                            document.getElementById('question2').value.trim(),
                            document.getElementById('question3').value.trim()
                        ],
                        selectedCards: [
                            document.getElementById('card1').value,
                            document.getElementById('card2').value,
                            document.getElementById('card3').value
                        ],
                        readings: []
                    };

                    // Validate all required fields
                    if (!userData.name || !userData.email || !userData.birthdate || !userData.readingType ||
                        !userData.questions.every(q => q) || !userData.selectedCards.every(c => c)) {
                        throw new Error('Please fill in all required fields');
                    }

                    console.log('Form data:', userData);

                    // Get individual readings
                    const readings = await Promise.all([
                        getReading(userData.questions[0], userData.selectedCards[0], userData.name),
                        getReading(userData.questions[1], userData.selectedCards[1], userData.name),
                        getReading(userData.questions[2], userData.selectedCards[2], userData.name)
                    ]);

                    readings.forEach((reading, index) => {
                        userData.readings.push({
                            question: userData.questions[index],
                            card: userData.selectedCards[index],
                            reading: reading
                        });
                    });

                    // Get realm reading
                    const realmReading = await getRealmReading(userData.questions[0], userData.selectedCards, userData.name);
                    userData.realmReading = realmReading;

                    // Log the final data before redirect
                    console.log('Final data:', userData);

                    // Redirect to reading page
                    const encodedData = encodeURIComponent(JSON.stringify(userData));
                    window.location.href = `reading.html?readingData=${encodedData}`;

                } catch (error) {
                    console.error('Error:', error);
                    alert(error.message || 'An error occurred while preparing your reading. Please try again.');
                    submitButton.disabled = false;
                    submitButton.innerHTML = '<span class="button-text">Enter into the Realm of Tarot</span><i class="fas fa-moon"></i>';
                }

                return false; // Prevent form from submitting normally
            }

            async function getReading(question, card, userName) {
                // Get the actual card name from the file naming structure
                const cardName = getCardName(card).replace(/^The /, ''); // Remove 'The ' prefix if present
                const firstName = userName.split(' ')[0]; // Get first name
                
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${CONFIG.OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "gpt-4",
                        messages: [{
                            role: "user",
                            content: `You are a wise and experienced tarot reader with deep spiritual insight. ${firstName} has drawn the ${cardName} card in response to their question: "${question}".

As you gaze into the mystical energies surrounding ${firstName}, interpret the ${cardName} card with the following aspects:

1. Begin with a brief, mystical observation about the energy you sense around this card draw
2. Describe the key symbols and imagery present in the ${cardName}, and their spiritual significance
3. Explain how these symbols specifically relate to ${firstName}'s question
4. Provide spiritual guidance and insights about potential paths forward
5. End with a short, wise reflection or piece of advice that ${firstName} should meditate on

Keep the tone mystical and wise, but also warm and personal. Speak directly to ${firstName} as if they are sitting across from you in a candlelit room filled with spiritual energy.`
                        }],
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                return data.choices[0].message.content;
            }

            async function getRealmReading(mainQuestion, cards, userName) {
                const firstName = userName.split(' ')[0]; // Get first name
                const cardNames = cards.map(card => getCardName(card).replace(/^The /, '')).join(', ');
                
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${CONFIG.OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "gpt-4",
                        messages: [{
                            role: "user",
                            content: `You are a wise and experienced tarot reader with deep spiritual insight. ${firstName} has drawn three powerful cards: ${cardNames}. These cards have appeared together in response to their journey and their primary question: "${mainQuestion}".

As you meditate on the mystical convergence of these cards, provide a holistic reading that:

1. Begin with an observation about the overall energy pattern you sense in this spread
2. Explore how these three cards interact and create a unique narrative for ${firstName}
3. Identify any significant patterns, elements, or symbols that appear across multiple cards
4. Explain how this combination of cards creates a deeper meaning for ${firstName}'s journey
5. Provide spiritual guidance about the larger life path or cycle that ${firstName} is currently experiencing
6. Close with a powerful insight or piece of wisdom that emerges from this unique combination

Speak with the wisdom of the ages, but maintain a personal connection to ${firstName}. Your words should feel both ancient and intimately relevant to their current situation.`
                        }],
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                return data.choices[0].message.content;
            }

            function getCardName(cardNumber) {
                const cardNames = {
                    1: 'The Fool',
                    2: 'The Magician',
                    3: 'The High Priestess',
                    4: 'The Empress',
                    5: 'The Emperor',
                    6: 'The Hierophant',
                    7: 'The Lovers',
                    8: 'The Chariot',
                    9: 'Strength',
                    10: 'The Hermit',
                    11: 'Wheel of Fortune',
                    12: 'Justice',
                    13: 'The Hanged Man',
                    14: 'Death',
                    15: 'Temperance',
                    16: 'The Devil',
                    17: 'The Tower',
                    18: 'TheStar',
                    19: 'The Moon',
                    20: 'The Sun',
                    21: 'Judgment',
                    22: 'The World',
                    23: 'Ace of Wands',
                    24: 'Two of Wands',
                    25: 'Three of Wands',
                    26: 'Four of Wands',
                    27: 'Five of Wands',
                    28: 'Six of Wands',
                    29: 'seven of Wands',
                    30: 'Eight of Wands',
                    31: 'Nine of Wands',
                    32: 'Ten of Wands',
                    33: 'Page of Wands',
                    34: 'Knight of Wands',
                    35: 'Queen of Wands',
                    36: 'King of Wands',
                    37: 'Ace of Cups',
                    38: 'Two of Cups',
                    39: 'Three of Cups',
                    40: 'Four of Cups',
                    41: 'Five of Cups',
                    42: 'Six of Cups',
                    43: 'Seven of Cups',
                    44: 'Eight of Cups',
                    45: 'Nine of Cups',
                    46: 'Ten of Cups',
                    47: 'Page of Cups',
                    48: 'Knight of Cups',
                    49: 'Queen of Cups',
                    50: 'King of Cups',
                    51: 'Ace of Pentacles',
                    52: 'Two of Pentacles',
                    53: 'Three of Pentacles',
                    54: 'Four of Pentacles',
                    55: 'Five of Pentacles',
                    56: 'Six of Pentacles',
                    57: 'Seven of Pentacles',
                    58: 'Eight of Pentacles',
                    59: 'Nine of Pentacles',
                    60: 'Ten of Pentacles',
                    61: 'Page of Pentacles',
                    62: 'Knight of Pentacles',
                    63: 'Queen of Pentacles',
                    64: 'King of Pentacles',
                    65: 'Ace of Swords',
                    66: 'Two of Swords',
                    67: 'Three of Swords',
                    68: 'Four of Swords',
                    69: 'Five of Swords',
                    70: 'Six of Swords',
                    71: 'Seven of Swords',
                    72: 'Eight of Swords',
                    73: 'Nine of Swords',
                    74: 'Ten of Swords',
                    75: 'Page of Swords',
                    76: 'Knight of Swords',
                    77: 'Queen of Swords',
                    78: 'King of Swords'
                };
                return cardNames[cardNumber] || `Card ${cardNumber}`;
            }
        </script>
    </main>

</body>
</html>
